<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Extending Grumps · Grumps.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Grumps.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../estimators/">Estimators</a></li><li><a class="tocitem" href="../quickstart/">Quick start</a></li><li><a class="tocitem" href="../objects/">User interface</a></li><li><a class="tocitem" href="../spreadsheet/">Spreadsheet formats</a></li><li><a class="tocitem" href="../example/">Example program</a></li><li><a class="tocitem" href="../speedmemory/">Speed, memory, accuracy</a></li><li><a class="tocitem" href="../bearinmind/">Things to bear in mind</a></li><li><a class="tocitem" href="../structure/">Directory structure</a></li><li><a class="tocitem" href="../flow/">Algorithm flow</a></li><li class="is-active"><a class="tocitem" href>Extending Grumps</a><ul class="internal"><li><a class="tocitem" href="#using-a-new-data-format"><span>using a new data format</span></a></li><li><a class="tocitem" href="#adding-a-new-estimator"><span>adding a new estimator</span></a></li><li><a class="tocitem" href="#adding-an-integrator"><span>adding an integrator</span></a></li></ul></li><li><a class="tocitem" href="../aliens/">Languages other than Julia</a></li><li><a class="tocitem" href="../misc/">Miscellanea</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Extending Grumps</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Extending Grumps</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NittanyLion/Grumps.jl/blob/master/docs/src/extending.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Extending-Grumps"><a class="docs-heading-anchor" href="#Extending-Grumps">Extending Grumps</a><a id="Extending-Grumps-1"></a><a class="docs-heading-anchor-permalink" href="#Extending-Grumps" title="Permalink"></a></h1><p>Grumps can be extended in multiple ways.  Below three possibilities are discussed, namely using an existing estimator for a different data format, introducing a new <em>estimator</em>, and introducing a new <em>integrator</em>.</p><h2 id="using-a-new-data-format"><a class="docs-heading-anchor" href="#using-a-new-data-format">using a new data format</a><a id="using-a-new-data-format-1"></a><a class="docs-heading-anchor-permalink" href="#using-a-new-data-format" title="Permalink"></a></h2><p>The most general way of doing this is to fill the <code>GrumpsData</code> object with something of your own creation.  An easier way of doing this is to use the <code>UserEnhancement</code> argument in the call to <a href="../objects/#Grumps.Data-Tuple{}"><code>Data()</code></a>.  </p><div class="admonition is-danger"><header class="admonition-header">The user enhancement code has not been tested yet and needs work.</header><div class="admonition-body"><p>Use it at your own risk.</p></div></div><h2 id="adding-a-new-estimator"><a class="docs-heading-anchor" href="#adding-a-new-estimator">adding a new estimator</a><a id="adding-a-new-estimator-1"></a><a class="docs-heading-anchor-permalink" href="#adding-a-new-estimator" title="Permalink"></a></h2><h3 id="estimator-definitions"><a class="docs-heading-anchor" href="#estimator-definitions">estimator definitions</a><a id="estimator-definitions-1"></a><a class="docs-heading-anchor-permalink" href="#estimator-definitions" title="Permalink"></a></h3><p>A new estimator can be added by creating a new folder in the <a href="../structure/#estimators-folder">estimators folder</a>.  By creating the folder, Grumps will automatically try to load an eponymous Julia file in that folder every time Grumps is run.  For instance, in <code>src/estimators/pml</code> you see a file <code>pml.jl</code>, which loads all Julia files in the folder <em>other than</em> <code>description.jl</code>. The file <code>description.jl</code> is loaded separately and automatically. </p><p>The symbol used for the new estimator will correspond to the folder name.  For instance, if the folder name is <code>foo</code> then the new estimator symbol will be <code>:foo</code>.</p><p>The file <code>description.jl</code> should contain exactly two functions: <code>name</code> and <code>Description</code>.  It suffices to copy the <code>description.jl</code> file from another estimators folder and changing the particulars for your estimator.</p><p>For instance, the <code>pml</code> folder contains the file <code>description.jl</code> with contents</p><pre><code class="nohighlight hljs">name( ::Val{:pml} ) = &quot;Grumps Penalized MLE&quot;

function Description( e :: Symbol, v ::Val{ :pml } )
    @ensure e == :pml &quot;oops!&quot;
    return EstimatorDescription( e, name( Val( :pml ) ), 
      [ &quot;grumps&quot;, &quot;pmle&quot;, &quot;grumps penalized mle&quot;, &quot;penalized likelihood&quot;, &quot;grump
s penalized maximum likelihood&quot;, &quot;pml&quot;, &quot;penmaxlik&quot; ]
      )
end</code></pre><p>All you need to do here is to change all the <code>:pml</code> entries to <code>:foo</code>, to change the return value of <code>name</code> to <code>&quot;Foo Estimator&quot;</code> and the array of strings in the return value of <code>Description</code> to a list of descriptors of your estimation method that define it clearly and set it apart from other estimators.  Make sure that none of the descriptors are used by other estimators.</p><p>In a file loaded by <code>foo.jl</code>, preferably <code>types.jl</code>, one should define some properties of the estimators. In addition, there is a type associated with your estimator. For instance, the file <code>types.jl</code> in the <code>pml</code> folder contains</p><pre><code class="nohighlight hljs">struct GrumpsPMLEstimator &lt;: GrumpsPenalized
    function GrumpsPMLEstimator() 
        new()
    end
end

name( ::GrumpsPMLEstimator ) = name( Val( :pml ) )

inisout( ::GrumpsPMLEstimator ) = true

Estimator( ::Val{ :pml } ) = GrumpsPMLEstimator()</code></pre><p>The estimator type <code>GrumpsPMLEstimator</code> is used to allow Grumps to use the same function name with the estimator type to call different methods.  Note that <code>GrumpsPMLEstimator</code> is a subtype of <code>GrumpsPenalized</code>, which is done to allow for a single function call with different estimator type argument to select a method for all estimators that are subtypes of <code>GrumpsPenalized</code>.</p><p>For example, if one calls a function with an estimator type (and other arguments) then there is a default method that will be called unless there is a method defined for the desired supertype (e.g. <code>GrumpsPenalized</code>), which will be called unless there is a method defined for the exact estimator type (e.g. <code>GrumpsPMLEstimator</code>).</p><p>For instance, the outer objective functions are all called <code>ObjectiveFunctionθ!</code> but which one is used depends on the estimator supertype.  For <code>GrumpsPenalized</code> it is the one in <code>src/common/optim/objpml.jl</code>.  Note that you can define different objective functions depending on e.g. the <code>GrumpsData</code> type that is passed, also.</p><p>For the new estimator <code>:foo</code> the <code>name</code> and <code>Estimator</code> methods in the above file can be changed by replacing <code>:pml</code> with <code>:foo</code> and <code>PML</code> with <code>Foo</code> everywhere, assuming that the new estimator type is <code>GrumpsFooEstimator</code>.</p><p>The final entry in <code>types.jl</code> is the line  <code>inisout( ::GrumpsPMLEstimator ) = true</code> What this line does is to tell Grumps that the objective function value in the inner optimization problem is the same as that in the outer optimization problem.  This is true for most estimators, but not for e.g. the share constraint estimator.  There are a number of properties like this (type <code>Estimators(true)</code> in the REPL to see them all), whose default values are in <code>src/common/types/est.jl</code>.</p><p>Now, the <code>:vanilla</code> (the Grumps estimator with exact identification in the product level moments) and <code>:shareconstraint</code> (ditto, but where the inner optimization runs maximizes only the macro likelihood) computations differ only in the contents of the <code>theta.jl</code> and <code>delta.jl</code> files.  In this case, the <code>theta.jl</code> files produce the single market outer objective function contributions and its first two derivatives and <code>delta.j</code> does ditto for the inner objective functions.</p><h3 id="Data-types"><a class="docs-heading-anchor" href="#Data-types">Data types</a><a id="Data-types-1"></a><a class="docs-heading-anchor-permalink" href="#Data-types" title="Permalink"></a></h3><p>There are several predefined <code>Data</code> types, which can be found in <code>src/common/types/data.jl</code>.  For instance, <code>GrumpsData</code> contains a vector of <code>GrumpsMarketData</code> objects (one for each market), a <code>GrumpsPLMData</code> object, and some other things.  <code>GrumpsPLMData</code> is for the penalty term.</p><p>Each <code>GrumpsMarketData</code> object contains a <code>GrumpsMicroData</code> object and a <code>GrumpsMacroData</code> object, one for the micro portion of the likelihood, and one for the macro portion of the likelihood.  These are themselves supertypes, so you can use/require whichever subtype you desire for your estimator, but if one of the existing ones suffices then use that.</p><h3 id="FGH-types"><a class="docs-heading-anchor" href="#FGH-types">FGH types</a><a id="FGH-types-1"></a><a class="docs-heading-anchor-permalink" href="#FGH-types" title="Permalink"></a></h3><p>FGH types contain the objective function and its derivatives.  These can be by market or apply to (or contain results for) a number of markets.  If <code>inisout</code> returns <code>true</code> then the inner and outer objective <code>FGH</code> objects are physically the same.</p><h3 id="Space-types"><a class="docs-heading-anchor" href="#Space-types">Space types</a><a id="Space-types-1"></a><a class="docs-heading-anchor-permalink" href="#Space-types" title="Permalink"></a></h3><p>Grumps preallocates space for choice probabilities and related objects and reuses their values where possible.  This saves computation time.  In most instances, the space types provided will suffice.</p><h2 id="adding-an-integrator"><a class="docs-heading-anchor" href="#adding-an-integrator">adding an integrator</a><a id="adding-an-integrator-1"></a><a class="docs-heading-anchor-permalink" href="#adding-an-integrator" title="Permalink"></a></h2><p><strong>to be done</strong></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../flow/">« Algorithm flow</a><a class="docs-footer-nextpage" href="../aliens/">Languages other than Julia »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Saturday 6 May 2023 17:52">Saturday 6 May 2023</span>. Using Julia version 1.10.0-DEV.1234.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
