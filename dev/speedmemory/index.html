<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Speed, memory, accuracy · Grumps.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Grumps.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../estimators/">Estimators</a></li><li><a class="tocitem" href="../quickstart/">Quick start</a></li><li><a class="tocitem" href="../objects/">User interface</a></li><li><a class="tocitem" href="../spreadsheet/">Spreadsheet formats</a></li><li><a class="tocitem" href="../example/">Example program</a></li><li class="is-active"><a class="tocitem" href>Speed, memory, accuracy</a><ul class="internal"><li><a class="tocitem" href="#Memory-conservation"><span>Memory conservation</span></a></li><li><a class="tocitem" href="#Speed"><span>Speed</span></a></li><li><a class="tocitem" href="#Accuracy"><span>Accuracy</span></a></li></ul></li><li><a class="tocitem" href="../bearinmind/">Things to bear in mind</a></li><li><a class="tocitem" href="../structure/">Directory structure</a></li><li><a class="tocitem" href="../flow/">Algorithm flow</a></li><li><a class="tocitem" href="../extending/">Extending Grumps</a></li><li><a class="tocitem" href="../aliens/">Languages other than Julia</a></li><li><a class="tocitem" href="../misc/">Miscellanea</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Speed, memory, accuracy</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Speed, memory, accuracy</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NittanyLion/Grumps.jl/blob/master/docs/src/speedmemory.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Speed,-memory,-and-accuracy"><a class="docs-heading-anchor" href="#Speed,-memory,-and-accuracy">Speed, memory, and accuracy</a><a id="Speed,-memory,-and-accuracy-1"></a><a class="docs-heading-anchor-permalink" href="#Speed,-memory,-and-accuracy" title="Permalink"></a></h1><h2 id="Memory-conservation"><a class="docs-heading-anchor" href="#Memory-conservation">Memory conservation</a><a id="Memory-conservation-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-conservation" title="Permalink"></a></h2><p>By default, Grumps loads all data and then creates space for all markets for things like choice probabilities, objective functions and their derivatives, intermediate objects, etcetera.  This saves computation time, but eats memory, especially as the number of random coefficients increases.</p><p>There are several ways of addressing memory issues.  First, it is generally a good idea to be modest in the number of random coefficients one uses.  In terms of computation it adds to memory demands.</p><p>Second, one can set <code>memsave</code> in <a href="../objects/#Grumps.OptimizationOptions-Tuple{}"><code>OptimizationOptions()</code></a> to <code>true</code>.  This reduces memory requirements by sharing space for choice probabilities and related objects across a number of markets based on the number of threads.  For instance, if there are ten markets and the number of market threads in <a href="../objects/#Grumps.OptimizationOptions-Tuple{}"><code>OptimizationOptions()</code></a> is set to two then the space for choice probabilities is shared across five markets.   The downside of doing this is that it slows down computation since some objects will need to be recomputed multiple times during estimation.   This is especially true for estimators that use the penalty term in the inside optimization, i.e. currently only the full Grumps estimator.  A secondary downside is that to implement this feature without excessive allocations, the code to achieve this is low-level.  In particular, do not call <code>grumps!</code> from different threads in the same program (different processes is fine) when using <code>memsave</code>. Note that <code>memsave</code> will have no effect if the number of market threads is no less than the number of markets. </p><div class="admonition is-success"><header class="admonition-header">When to use `memsave`</header><div class="admonition-body"><p>Try turning <code>memsave</code> on if Grumps is paging or running out of RAM. Otherwise, leave it off. </p></div></div><h2 id="Speed"><a class="docs-heading-anchor" href="#Speed">Speed</a><a id="Speed-1"></a><a class="docs-heading-anchor-permalink" href="#Speed" title="Permalink"></a></h2><p>There are several reasons that would make Grumps slow:</p><ul><li>Grumps can naturally take a while if the data set is large.  </li><li>Computation time grows fast in the number of random coefficients.  </li><li>The full CLER estimator (especially with <code>memsave</code> on) is slower than its cheap alternative.  </li><li>Using global variables is a bad idea in any programming language and especially in Julia (bury everything inside a function). In Julia type stability can also be an issue.</li><li>Tolerances and iteration counts (not an issue with the defaults).</li><li>Using <code>robust</code> choice probabilities makes run times longer (the default is <code>fast</code>). </li><li>Make sure you are not running Julia in single thread mode.  Start Julia with <code>julia -t 16</code> if you have 16 physical cores in your computer.</li><li>The number of threads used for various activities can be specified via <a href="../objects/#Grumps.OptimizationOptions-Tuple{}"><code>OptimizationOptions()</code></a>.  The defaults may not be optimal, but are usually ok.</li><li>Using a <code>BigFloat</code> type instead of <code>Float64</code> adds precision but the performance penalty is severe.</li></ul><h2 id="Accuracy"><a class="docs-heading-anchor" href="#Accuracy">Accuracy</a><a id="Accuracy-1"></a><a class="docs-heading-anchor-permalink" href="#Accuracy" title="Permalink"></a></h2><p>The main things one can do to improve accuracy is to experiment with the tolerances.  Other options that would slow down computation are to use <code>robust</code> choice probabilities and higher precision floating points types, but that should be an option of last resort.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example/">« Example program</a><a class="docs-footer-nextpage" href="../bearinmind/">Things to bear in mind »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Friday 12 May 2023 00:34">Friday 12 May 2023</span>. Using Julia version 1.10.0-DEV.1273.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
